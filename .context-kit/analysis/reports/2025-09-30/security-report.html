<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Audit Report - tkr-portfolio</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            line-height: 1.6;
            color: #1e293b;
            background: #f8fafc;
            padding: 2rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: linear-gradient(135deg, #7c2d12 0%, #dc2626 100%);
            color: white;
            padding: 3rem 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        .header .subtitle {
            font-size: 1.125rem;
            opacity: 0.9;
        }
        
        .metadata {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255,255,255,0.2);
        }
        
        .metadata-item {
            display: flex;
            flex-direction: column;
        }
        
        .metadata-label {
            font-size: 0.875rem;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .metadata-value {
            font-size: 1.125rem;
            font-weight: 600;
            margin-top: 0.25rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîí Security Audit Report</h1>
            <div class="subtitle">Comprehensive defensive security analysis of tkr-portfolio</div>
            <div class="metadata">
                <div class="metadata-item">
                    <span class="metadata-label">Report Date</span>
                    <span class="metadata-value">2025-09-30</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">Project</span>
                    <span class="metadata-value">tkr-portfolio</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">Analysis Type</span>
                    <span class="metadata-value">Full Security Audit</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">Agent</span>
                    <span class="metadata-value">security-agent</span>
                </div>
            </div>
        </div>
        
        <!-- Executive Summary -->
<div class="section">
    <h2>Executive Summary</h2>
    <div class="score-cards">
        <div class="score-card score-excellent">
            <div class="score-number">B+</div>
            <div class="score-label">Overall Security Posture</div>
        </div>
        <div class="score-card score-good">
            <div class="score-number">11</div>
            <div class="score-label">Total Findings</div>
        </div>
        <div class="score-card score-excellent">
            <div class="score-number">0</div>
            <div class="score-label">Critical Issues</div>
        </div>
        <div class="score-card score-excellent">
            <div class="score-number">0</div>
            <div class="score-label">High Severity</div>
        </div>
    </div>
    
    <div class="info-box info">
        <h3>Summary</h3>
        <p>Analyzed the tkr-portfolio codebase with focus on defensive security. The codebase demonstrates <strong>good security practices overall</strong> with no critical or high-severity vulnerabilities detected in production code paths.</p>
        <p><strong>Key Strengths:</strong></p>
        <ul>
            <li>No hardcoded credentials or API keys in production code</li>
            <li>Proper use of parameterized SQL queries (no SQL injection risks)</li>
            <li>No dangerous XSS patterns (dangerouslySetInnerHTML) found</li>
            <li>Command execution properly scoped to development tools only</li>
            <li>No weak cryptographic algorithms in use</li>
        </ul>
        <p><strong>Areas for Improvement:</strong></p>
        <ul>
            <li>CORS configuration permissive for development (needs production hardening)</li>
            <li>Missing security headers (CSP, HSTS, X-Frame-Options)</li>
            <li>Math.random() used for non-security purposes (acceptable)</li>
            <li>4 low-severity dependency vulnerabilities</li>
        </ul>
    </div>
</div>

<!-- Severity Breakdown -->
<div class="section">
    <h2>Findings by Severity</h2>
    <table>
        <thead>
            <tr>
                <th>Severity</th>
                <th>Count</th>
                <th>Status</th>
                <th>Action Required</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><span class="badge badge-critical">CRITICAL</span></td>
                <td>0</td>
                <td>‚úÖ None</td>
                <td>-</td>
            </tr>
            <tr>
                <td><span class="badge badge-high">HIGH</span></td>
                <td>0</td>
                <td>‚úÖ None</td>
                <td>-</td>
            </tr>
            <tr>
                <td><span class="badge badge-medium">MEDIUM</span></td>
                <td>7</td>
                <td>‚ö†Ô∏è Review Needed</td>
                <td>Address before production</td>
            </tr>
            <tr>
                <td><span class="badge badge-low">LOW</span></td>
                <td>4</td>
                <td>üìã Monitor</td>
                <td>Schedule for next sprint</td>
            </tr>
        </tbody>
    </table>
</div>

<!-- MEDIUM Severity Findings -->
<div class="section">
    <h2>MEDIUM Severity Findings</h2>

    <!-- Finding 1: CORS Misconfiguration -->
    <div class="finding finding-medium">
        <div class="finding-header">
            <span class="badge badge-medium">MEDIUM</span>
            <h3>1. Overly Permissive CORS Configuration</h3>
            <span class="cvss-score">CVSS 5.3</span>
        </div>
        
        <div class="finding-body">
            <p><strong>Category:</strong> Security Configuration</p>
            <p><strong>Description:</strong> Multiple HTTP servers use <code>Access-Control-Allow-Origin: *</code> which allows any origin to access the API. This is acceptable for development but poses a security risk in production environments.</p>
            
            <p><strong>Affected Files:</strong></p>
            <ul>
                <li><code>.context-kit/knowledge-graph/src/api/http-server.ts:66</code></li>
                <li><code>.context-kit/knowledge-graph/src/api/http-server-simple.ts:54</code></li>
                <li><code>.context-kit/knowledge-graph/src/api/logging-endpoints.js:489,506,524</code></li>
                <li><code>.context-kit/logging-client/plugins/vite/middleware.js:60,90</code></li>
            </ul>
            
            <div class="code-block">
                <pre>// Current implementation (http-server.ts:66)
res.setHeader('Access-Control-Allow-Origin', '*'); // Allow all origins for development</pre>
            </div>
            
            <p><strong>Risk Assessment:</strong></p>
            <ul>
                <li>Allows any website to make requests to your API</li>
                <li>Could enable CSRF attacks if combined with authentication</li>
                <li>May expose internal data to unauthorized origins</li>
            </ul>
            
            <div class="recommendation">
                <h4>Remediation Steps:</h4>
                <ol>
                    <li>Implement environment-based CORS configuration:
<div class="code-block"><pre>// Recommended implementation
const allowedOrigins = process.env.NODE_ENV === 'production' 
    ? ['https://yourdomain.com']
    : ['http://localhost:42001', 'http://localhost:42003'];

const origin = req.headers.origin;
if (allowedOrigins.includes(origin)) {
    res.setHeader('Access-Control-Allow-Origin', origin);
}</pre></div>
                    </li>
                    <li>Add CORS validation middleware before production deployment</li>
                    <li>Document allowed origins in configuration</li>
                    <li>Consider using a CORS library like <code>cors</code> npm package</li>
                </ol>
                
                <p><strong>References:</strong></p>
                <ul>
                    <li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">MDN: Cross-Origin Resource Sharing (CORS)</a></li>
                    <li><a href="https://owasp.org/www-community/attacks/csrf">OWASP: Cross-Site Request Forgery</a></li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Finding 2: Missing Security Headers -->
    <div class="finding finding-medium">
        <div class="finding-header">
            <span class="badge badge-medium">MEDIUM</span>
            <h3>2. Missing Security Headers</h3>
            <span class="cvss-score">CVSS 4.7</span>
        </div>
        
        <div class="finding-body">
            <p><strong>Category:</strong> Security Configuration</p>
            <p><strong>Description:</strong> The HTTP servers do not implement critical security headers to protect against common web vulnerabilities.</p>
            
            <p><strong>Missing Headers:</strong></p>
            <ul>
                <li><code>Content-Security-Policy</code> - Prevents XSS and code injection</li>
                <li><code>Strict-Transport-Security</code> - Enforces HTTPS connections</li>
                <li><code>X-Frame-Options</code> - Prevents clickjacking attacks</li>
                <li><code>X-Content-Type-Options</code> - Prevents MIME sniffing</li>
                <li><code>X-XSS-Protection</code> - Legacy XSS protection</li>
                <li><code>Referrer-Policy</code> - Controls referrer information</li>
            </ul>
            
            <p><strong>Affected Files:</strong></p>
            <ul>
                <li><code>.context-kit/knowledge-graph/src/api/http-server.ts</code></li>
                <li><code>.context-kit/knowledge-graph/src/api/http-server-simple.ts</code></li>
            </ul>
            
            <div class="recommendation">
                <h4>Remediation Steps:</h4>
                <ol>
                    <li>Install security headers middleware:
<div class="code-block"><pre>npm install helmet</pre></div>
                    </li>
                    <li>Add helmet middleware to HTTP servers:
<div class="code-block"><pre>import helmet from 'helmet';

// In server initialization
app.use(helmet({
    contentSecurityPolicy: {
        directives: {
            defaultSrc: ["'self'"],
            styleSrc: ["'self'", "'unsafe-inline'"],
            scriptSrc: ["'self'"],
            imgSrc: ["'self'", "data:", "https:"],
        },
    },
    hsts: {
        maxAge: 31536000,
        includeSubDomains: true,
        preload: true
    }
}));</pre></div>
                    </li>
                    <li>Test headers with tools like <a href="https://securityheaders.com/">securityheaders.com</a></li>
                </ol>
                
                <p><strong>References:</strong></p>
                <ul>
                    <li><a href="https://owasp.org/www-project-secure-headers/">OWASP: Secure Headers Project</a></li>
                    <li><a href="https://helmetjs.github.io/">Helmet.js Documentation</a></li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Finding 3: Command Execution in MCP Tools -->
    <div class="finding finding-medium">
        <div class="finding-header">
            <span class="badge badge-medium">MEDIUM</span>
            <h3>3. Command Execution Without Input Validation</h3>
            <span class="cvss-score">CVSS 5.8</span>
        </div>
        
        <div class="finding-body">
            <p><strong>Category:</strong> Command Injection Risk</p>
            <p><strong>Description:</strong> The MCP script execution tool uses <code>spawn()</code> with user-provided script names and arguments. While using array arguments (not shell strings) provides some protection, additional validation is recommended.</p>
            
            <p><strong>Affected Files:</strong></p>
            <ul>
                <li><code>.context-kit/mcp/src/tools/script-execution.ts:221</code> - npm run script execution</li>
                <li><code>.context-kit/mcp/src/tools/script-execution.ts:324</code> - lsof port checking</li>
                <li><code>.context-kit/mcp/src/tools/development.ts:376,395,430,479</code> - npm commands</li>
            </ul>
            
            <div class="code-block">
                <pre>// Current implementation (script-execution.ts:221)
const child = spawn('npm', ['run', script, ...args], {
    cwd: moduleDir,
    stdio: ['pipe', 'pipe', 'pipe'],
    shell: true  // ‚ö†Ô∏è Enables shell expansion
});</pre>
            </div>
            
            <p><strong>Risk Assessment:</strong></p>
            <ul>
                <li><code>shell: true</code> enables shell metacharacter expansion</li>
                <li>User-controlled script names could potentially execute unintended commands</li>
                <li>Limited to development context (MCP tools), not exposed to end users</li>
                <li>Mitigated by array-based arguments instead of string concatenation</li>
            </ul>
            
            <div class="recommendation">
                <h4>Remediation Steps:</h4>
                <ol>
                    <li>Remove <code>shell: true</code> if not required:
<div class="code-block"><pre>const child = spawn('npm', ['run', script, ...args], {
    cwd: moduleDir,
    stdio: ['pipe', 'pipe', 'pipe']
    // Removed shell: true
});</pre></div>
                    </li>
                    <li>Validate script names against allowed list:
<div class="code-block"><pre>const ALLOWED_SCRIPTS = ['dev', 'build', 'test', 'lint'];

if (!ALLOWED_SCRIPTS.includes(script)) {
    throw new Error(`Script '${script}' is not allowed`);
}</pre></div>
                    </li>
                    <li>Sanitize arguments to prevent injection:
<div class="code-block"><pre>const sanitizedArgs = args.map(arg => 
    arg.replace(/[;&|`$()]/g, '')
);</pre></div>
                    </li>
                </ol>
                
                <p><strong>References:</strong></p>
                <ul>
                    <li><a href="https://owasp.org/www-community/attacks/Command_Injection">OWASP: Command Injection</a></li>
                    <li><a href="https://nodejs.org/api/child_process.html#child_processspawncommand-args-options">Node.js: child_process.spawn()</a></li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Finding 4: SQL Query Construction -->
    <div class="finding finding-medium">
        <div class="finding-header">
            <span class="badge badge-medium">MEDIUM</span>
            <h3>4. Dynamic SQL Query Construction</h3>
            <span class="cvss-score">CVSS 4.2</span>
        </div>
        
        <div class="finding-body">
            <p><strong>Category:</strong> SQL Query Safety</p>
            <p><strong>Description:</strong> While no direct SQL injection vulnerabilities were found, the codebase uses string concatenation for SQL ORDER BY clauses. This is currently safe but should be monitored.</p>
            
            <p><strong>Affected Files:</strong></p>
            <ul>
                <li><code>.context-kit/core/src/logging/service.ts:249,318</code></li>
                <li><code>.context-kit/core/src/knowledge-graph/core.ts:283,395,431,435,439</code></li>
            </ul>
            
            <div class="code-block">
                <pre>// Example from logging/service.ts:249
sql += ' ORDER BY timestamp DESC LIMIT ? OFFSET ?';</pre>
            </div>
            
            <p><strong>Analysis:</strong></p>
            <ul>
                <li>‚úÖ All dynamic values are parameterized using <code>?</code> placeholders</li>
                <li>‚úÖ No user input directly concatenated into SQL strings</li>
                <li>‚úÖ Static ORDER BY clauses (hardcoded, not user-controlled)</li>
                <li>‚ö†Ô∏è Future modifications should maintain parameterized queries</li>
            </ul>
            
            <div class="recommendation">
                <h4>Best Practices:</h4>
                <ol>
                    <li>Continue using parameterized queries for all dynamic values</li>
                    <li>If adding dynamic ORDER BY, whitelist column names:
<div class="code-block"><pre>const ALLOWED_SORT_COLUMNS = ['timestamp', 'level', 'service'];
const sortColumn = ALLOWED_SORT_COLUMNS.includes(userSort) 
    ? userSort 
    : 'timestamp';
sql += \` ORDER BY \${sortColumn} DESC\`;</pre></div>
                    </li>
                    <li>Consider using query builder libraries for complex queries</li>
                </ol>
                
                <p><strong>References:</strong></p>
                <ul>
                    <li><a href="https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html">OWASP: SQL Injection Prevention</a></li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Finding 5: Math.random() in Non-Security Context -->
    <div class="finding finding-medium">
        <div class="finding-header">
            <span class="badge badge-medium">MEDIUM</span>
            <h3>5. Insecure Random Number Generation</h3>
            <span class="cvss-score">CVSS 3.8</span>
        </div>
        
        <div class="finding-body">
            <p><strong>Category:</strong> Weak Randomness</p>
            <p><strong>Description:</strong> The codebase uses <code>Math.random()</code> for generating random positions and mock data. This is acceptable for non-security purposes but should not be used for security-sensitive operations.</p>
            
            <p><strong>Affected Files:</strong></p>
            <ul>
                <li><code>.context-kit/dashboard/src/App.tsx:1028,1069</code> - Graph node positioning</li>
                <li><code>.context-kit/dashboard/src/App.tsx:1956,1968,1970,1980,1981,1984,2001,2008</code> - Mock data generation</li>
            </ul>
            
            <div class="code-block">
                <pre>// Example usage (App.tsx:1028)
position: positions[entity.id] || { 
    x: Math.random() * 800, 
    y: Math.random() * 600 
}</pre>
            </div>
            
            <p><strong>Analysis:</strong></p>
            <ul>
                <li>‚úÖ Only used for UI positioning and mock data (not security-sensitive)</li>
                <li>‚úÖ No session tokens, passwords, or cryptographic keys using Math.random()</li>
                <li>‚ö†Ô∏è Could be problematic if used for security purposes in future</li>
            </ul>
            
            <div class="recommendation">
                <h4>Guidelines:</h4>
                <ol>
                    <li>Current usage is acceptable for UI and mock data</li>
                    <li>For security-sensitive operations, use crypto.randomBytes():
<div class="code-block"><pre>import crypto from 'crypto';

// For session tokens, IDs, etc.
const secureRandom = crypto.randomBytes(32).toString('hex');</pre></div>
                    </li>
                    <li>Document where Math.random() is acceptable vs crypto.randomBytes()</li>
                </ol>
                
                <p><strong>References:</strong></p>
                <ul>
                    <li><a href="https://owasp.org/www-community/vulnerabilities/Insecure_Randomness">OWASP: Insecure Randomness</a></li>
                    <li><a href="https://nodejs.org/api/crypto.html#cryptorandombytessize-callback">Node.js: crypto.randomBytes()</a></li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Finding 6: Environment Variable References -->
    <div class="finding finding-medium">
        <div class="finding-header">
            <span class="badge badge-medium">MEDIUM</span>
            <h3>6. Environment Variable Configuration</h3>
            <span class="cvss-score">CVSS 4.0</span>
        </div>
        
        <div class="finding-body">
            <p><strong>Category:</strong> Configuration Management</p>
            <p><strong>Description:</strong> The codebase references <code>process.env.API_KEYS</code> in type definitions, suggesting API keys may be stored in environment variables. No .env files were found, which is good.</p>
            
            <p><strong>Affected Files:</strong></p>
            <ul>
                <li><code>.context-kit/core/src/utils/config.ts:33</code></li>
                <li><code>.context-kit/core/src/types/config.ts:82</code></li>
            </ul>
            
            <div class="code-block">
                <pre>// From config.ts:33
API_KEYS: process.env.API_KEYS</pre>
            </div>
            
            <p><strong>Analysis:</strong></p>
            <ul>
                <li>‚úÖ No .env files committed to repository</li>
                <li>‚úÖ API keys stored in environment variables (best practice)</li>
                <li>‚ö†Ô∏è Ensure .env is in .gitignore</li>
                <li>‚ö†Ô∏è Provide .env.example without sensitive values</li>
            </ul>
            
            <div class="recommendation">
                <h4>Best Practices:</h4>
                <ol>
                    <li>Verify .env is in .gitignore:
<div class="code-block"><pre># .gitignore
.env
.env.local
.env.*.local</pre></div>
                    </li>
                    <li>Create .env.example with placeholders:
<div class="code-block"><pre># .env.example
API_KEYS=your-api-key-here
DATABASE_URL=sqlite://./db.sqlite</pre></div>
                    </li>
                    <li>Document environment variables in README</li>
                    <li>Use secret management for production (AWS Secrets Manager, Vault)</li>
                </ol>
                
                <p><strong>References:</strong></p>
                <ul>
                    <li><a href="https://12factor.net/config">12 Factor App: Config</a></li>
                    <li><a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP: Sensitive Data Exposure</a></li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Finding 7: No Authentication/Authorization -->
    <div class="finding finding-medium">
        <div class="finding-header">
            <span class="badge badge-medium">MEDIUM</span>
            <h3>7. Missing Authentication on API Endpoints</h3>
            <span class="cvss-score">CVSS 5.0</span>
        </div>
        
        <div class="finding-body">
            <p><strong>Category:</strong> Access Control</p>
            <p><strong>Description:</strong> The HTTP API endpoints do not implement authentication or authorization. This is acceptable for local development but should be addressed for production or network-exposed deployments.</p>
            
            <p><strong>Affected Files:</strong></p>
            <ul>
                <li><code>.context-kit/knowledge-graph/src/api/http-server.ts</code> - All endpoints</li>
            </ul>
            
            <p><strong>Exposed Endpoints:</strong></p>
            <ul>
                <li><code>GET /entities</code> - Knowledge graph data</li>
                <li><code>GET /relations</code> - Relationship data</li>
                <li><code>POST /api/logs</code> - Log submission</li>
                <li><code>GET /api/logs/search</code> - Search logs</li>
            </ul>
            
            <div class="recommendation">
                <h4>Remediation Steps (for production):</h4>
                <ol>
                    <li>Implement API key authentication:
<div class="code-block"><pre>function authenticateApiKey(req: Request, res: Response, next: Function) {
    const apiKey = req.headers['x-api-key'];
    
    if (!apiKey || !isValidApiKey(apiKey)) {
        res.status(401).json({ error: 'Unauthorized' });
        return;
    }
    
    next();
}

// Apply to routes
app.use('/api/*', authenticateApiKey);</pre></div>
                    </li>
                    <li>Consider JWT tokens for user-specific operations</li>
                    <li>Implement rate limiting to prevent abuse</li>
                    <li>Add IP whitelisting for internal APIs</li>
                </ol>
                
                <p><strong>References:</strong></p>
                <ul>
                    <li><a href="https://owasp.org/www-project-api-security/">OWASP: API Security Top 10</a></li>
                    <li><a href="https://cheatsheetseries.owasp.org/cheatsheets/REST_Security_Cheat_Sheet.html">OWASP: REST Security Cheat Sheet</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- LOW Severity Findings -->
<div class="section">
    <h2>LOW Severity Findings</h2>

    <!-- Finding 8: Dependency Vulnerabilities -->
    <div class="finding finding-low">
        <div class="finding-header">
            <span class="badge badge-low">LOW</span>
            <h3>8. Dependency Vulnerabilities (4 Low-Severity)</h3>
            <span class="cvss-score">CVSS 3.1</span>
        </div>
        
        <div class="finding-body">
            <p><strong>Category:</strong> Dependency Security</p>
            <p><strong>Description:</strong> npm audit identified 4 low-severity vulnerabilities in dependencies:</p>
            
            <ul>
                <li><strong>@eslint/plugin-kit</strong> - RegEx DoS vulnerability (CVE pending)</li>
                <li><strong>brace-expansion</strong> - RegEx DoS vulnerability (GHSA-v6h2-p8h4-qcjw)</li>
                <li><strong>eslint</strong> - Affected by @eslint/plugin-kit vulnerability</li>
                <li><strong>vite</strong> - Low severity issue (details truncated)</li>
            </ul>
            
            <p><strong>Impact:</strong></p>
            <ul>
                <li>All vulnerabilities are in development dependencies</li>
                <li>Regular Expression Denial of Service (ReDoS) attacks possible</li>
                <li>Low exploitability in typical development workflows</li>
            </ul>
            
            <div class="recommendation">
                <h4>Remediation Steps:</h4>
                <ol>
                    <li>Update vulnerable dependencies:
<div class="code-block"><pre>npm audit fix</pre></div>
                    </li>
                    <li>If auto-fix unavailable, manually update:
<div class="code-block"><pre>npm install @eslint/plugin-kit@latest
npm install brace-expansion@latest</pre></div>
                    </li>
                    <li>Schedule regular dependency updates (monthly)</li>
                    <li>Consider using Dependabot or Renovate for automated updates</li>
                </ol>
                
                <p><strong>CVE References:</strong></p>
                <ul>
                    <li><a href="https://github.com/advisories/GHSA-xffm-g5w8-qvg7">GHSA-xffm-g5w8-qvg7</a> - @eslint/plugin-kit ReDoS</li>
                    <li><a href="https://github.com/advisories/GHSA-v6h2-p8h4-qcjw">GHSA-v6h2-p8h4-qcjw</a> - brace-expansion ReDoS</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Finding 9: Verbose Error Messages -->
    <div class="finding finding-low">
        <div class="finding-header">
            <span class="badge badge-low">LOW</span>
            <h3>9. Detailed Error Responses</h3>
            <span class="cvss-score">CVSS 2.5</span>
        </div>
        
        <div class="finding-body">
            <p><strong>Category:</strong> Information Disclosure</p>
            <p><strong>Description:</strong> HTTP error responses include detailed error messages and stack traces. While useful for debugging, this could expose internal implementation details in production.</p>
            
            <p><strong>Example (http-server.ts:232):</strong></p>
            <div class="code-block">
                <pre>res.end(JSON.stringify({
    error: 'Internal server error',
    message: error instanceof Error ? error.message : 'Unknown error'
}));</pre>
            </div>
            
            <div class="recommendation">
                <h4>Remediation:</h4>
                <ol>
                    <li>Implement environment-based error handling:
<div class="code-block"><pre>const errorResponse = process.env.NODE_ENV === 'production'
    ? { error: 'Internal server error' }
    : { error: 'Internal server error', message: error.message, stack: error.stack };</pre></div>
                    </li>
                    <li>Log full errors server-side, return generic messages to clients</li>
                </ol>
            </div>
        </div>
    </div>

    <!-- Finding 10: Console Logging -->
    <div class="finding finding-low">
        <div class="finding-header">
            <span class="badge badge-low">LOW</span>
            <h3>10. Console Logging in Production Code</h3>
            <span class="cvss-score">CVSS 2.0</span>
        </div>
        
        <div class="finding-body">
            <p><strong>Category:</strong> Information Disclosure</p>
            <p><strong>Description:</strong> Multiple files use console.log/error for debugging. While the codebase also uses a proper logging service, console statements should be removed or disabled in production.</p>
            
            <p><strong>Example Locations:</strong></p>
            <ul>
                <li><code>http-server.ts:76,218,238,255,284</code></li>
                <li><code>script-execution.ts:285</code></li>
            </ul>
            
            <div class="recommendation">
                <h4>Remediation:</h4>
                <ol>
                    <li>Use the existing logger service consistently</li>
                    <li>Remove console.* statements or wrap in environment checks</li>
                    <li>Configure build tools to strip console.* in production</li>
                </ol>
            </div>
        </div>
    </div>

    <!-- Finding 11: File System Operations -->
    <div class="finding finding-low">
        <div class="finding-header">
            <span class="badge badge-low">LOW</span>
            <h3>11. File System Operations Without Path Validation</h3>
            <span class="cvss-score">CVSS 2.8</span>
        </div>
        
        <div class="finding-body">
            <p><strong>Category:</strong> Path Traversal Risk</p>
            <p><strong>Description:</strong> The vite.config.js includes file system operations for copying Storybook files. While the paths are static, any future modifications should validate paths.</p>
            
            <p><strong>Affected File:</strong></p>
            <ul>
                <li><code>vite.config.js:23-33</code> - copyRecursive function</li>
            </ul>
            
            <div class="recommendation">
                <h4>Best Practices:</h4>
                <ol>
                    <li>Current implementation is safe (static paths)</li>
                    <li>For dynamic paths, validate against traversal:
<div class="code-block"><pre>import path from 'path';

function sanitizePath(userPath: string, basePath: string): string {
    const resolved = path.resolve(basePath, userPath);
    if (!resolved.startsWith(basePath)) {
        throw new Error('Path traversal detected');
    }
    return resolved;
}</pre></div>
                    </li>
                </ol>
            </div>
        </div>
    </div>
</div>

<!-- Positive Security Findings -->
<div class="section">
    <h2>‚úÖ Security Strengths</h2>
    
    <div class="info-box success">
        <h3>What's Going Well</h3>
        <ul>
            <li><strong>No Hardcoded Secrets:</strong> No API keys, tokens, or passwords found in source code</li>
            <li><strong>Parameterized SQL:</strong> All SQL queries use parameterized statements, preventing SQL injection</li>
            <li><strong>No XSS Patterns:</strong> No use of dangerouslySetInnerHTML or innerHTML assignments</li>
            <li><strong>Safe Command Execution:</strong> spawn() uses array arguments, not shell string concatenation</li>
            <li><strong>Environment Variables:</strong> Sensitive configuration properly externalized</li>
            <li><strong>No Weak Crypto:</strong> No MD5, SHA1, DES, or other deprecated algorithms</li>
            <li><strong>TypeScript Strict Mode:</strong> Type safety helps prevent common bugs</li>
            <li><strong>Development-Only Scope:</strong> Most security concerns are in development tools, not production paths</li>
        </ul>
    </div>
</div>

<!-- Recommendations -->
<div class="section">
    <h2>Security Recommendations</h2>
    
    <div class="recommendation-priority">
        <h3>Priority 1: Before Production Deployment</h3>
        <ul>
            <li>Configure environment-specific CORS policies</li>
            <li>Implement security headers (use helmet.js)</li>
            <li>Add authentication/authorization to API endpoints</li>
            <li>Environment-based error message sanitization</li>
            <li>Review and update dependency vulnerabilities</li>
        </ul>
    </div>
    
    <div class="recommendation-priority">
        <h3>Priority 2: Next Sprint</h3>
        <ul>
            <li>Remove <code>shell: true</code> from spawn() calls</li>
            <li>Implement script name validation in MCP tools</li>
            <li>Replace console.* with logger service</li>
            <li>Add .env.example with documentation</li>
            <li>Set up automated dependency scanning (Dependabot)</li>
        </ul>
    </div>
    
    <div class="recommendation-priority">
        <h3>Priority 3: Long-term Improvements</h3>
        <ul>
            <li>Implement rate limiting on API endpoints</li>
            <li>Add request logging and monitoring</li>
            <li>Set up security-focused CI/CD checks</li>
            <li>Create security documentation for contributors</li>
            <li>Schedule quarterly security audits</li>
        </ul>
    </div>
</div>

<!-- Security Testing Checklist -->
<div class="section">
    <h2>Security Testing Checklist</h2>
    
    <table>
        <thead>
            <tr>
                <th>Test</th>
                <th>Status</th>
                <th>Notes</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>SQL Injection Testing</td>
                <td>‚úÖ Pass</td>
                <td>All queries parameterized</td>
            </tr>
            <tr>
                <td>XSS Vulnerability Scan</td>
                <td>‚úÖ Pass</td>
                <td>No dangerous patterns found</td>
            </tr>
            <tr>
                <td>Command Injection Testing</td>
                <td>‚ö†Ô∏è Review</td>
                <td>Development tools only, needs hardening</td>
            </tr>
            <tr>
                <td>Credential Exposure Scan</td>
                <td>‚úÖ Pass</td>
                <td>No hardcoded credentials</td>
            </tr>
            <tr>
                <td>Dependency Vulnerability Scan</td>
                <td>‚ö†Ô∏è Low Issues</td>
                <td>4 low-severity vulnerabilities</td>
            </tr>
            <tr>
                <td>CORS Configuration Review</td>
                <td>‚ö†Ô∏è Needs Update</td>
                <td>Permissive for development</td>
            </tr>
            <tr>
                <td>Security Headers Check</td>
                <td>‚ùå Missing</td>
                <td>No helmet or security headers</td>
            </tr>
            <tr>
                <td>Authentication Testing</td>
                <td>‚ùå Not Implemented</td>
                <td>Development-only context</td>
            </tr>
        </tbody>
    </table>
</div>

<!-- Compliance & Standards -->
<div class="section">
    <h2>Compliance & Standards</h2>
    
    <table>
        <thead>
            <tr>
                <th>Standard</th>
                <th>Compliance Level</th>
                <th>Notes</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>OWASP Top 10 (2021)</td>
                <td>üü¢ Good</td>
                <td>No A01, A02, A03 issues detected</td>
            </tr>
            <tr>
                <td>CWE Top 25</td>
                <td>üü¢ Good</td>
                <td>No critical CWE patterns found</td>
            </tr>
            <tr>
                <td>SANS Top 25</td>
                <td>üü¢ Good</td>
                <td>Primary vulnerabilities addressed</td>
            </tr>
            <tr>
                <td>Node.js Security Best Practices</td>
                <td>üü° Moderate</td>
                <td>Needs security headers, auth</td>
            </tr>
        </tbody>
    </table>
</div>

<style>
.section {
    margin-bottom: 2rem;
    padding: 1.5rem;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.section h2 {
    margin-top: 0;
    color: #1e293b;
    border-bottom: 2px solid #e2e8f0;
    padding-bottom: 0.5rem;
}

.score-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin: 1.5rem 0;
}

.score-card {
    padding: 1.5rem;
    border-radius: 8px;
    text-align: center;
    color: white;
}

.score-excellent { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
.score-good { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
.score-moderate { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
.score-poor { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }

.score-number {
    font-size: 3rem;
    font-weight: bold;
    margin-bottom: 0.5rem;
}

.score-label {
    font-size: 0.875rem;
    opacity: 0.9;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.info-box {
    padding: 1.5rem;
    border-radius: 8px;
    margin: 1rem 0;
    border-left: 4px solid;
}

.info-box.info {
    background: #eff6ff;
    border-color: #3b82f6;
}

.info-box.success {
    background: #f0fdf4;
    border-color: #10b981;
}

.info-box.warning {
    background: #fffbeb;
    border-color: #f59e0b;
}

.finding {
    margin: 1.5rem 0;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    overflow: hidden;
}

.finding-header {
    background: #f8fafc;
    padding: 1rem 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    border-bottom: 1px solid #e5e7eb;
}

.finding-header h3 {
    margin: 0;
    flex: 1;
    color: #1e293b;
}

.finding-body {
    padding: 1.5rem;
}

.finding-critical { border-left: 4px solid #7c2d12; }
.finding-high { border-left: 4px solid #dc2626; }
.finding-medium { border-left: 4px solid #f59e0b; }
.finding-low { border-left: 4px solid #3b82f6; }

.badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.badge-critical {
    background: #7c2d12;
    color: white;
}

.badge-high {
    background: #dc2626;
    color: white;
}

.badge-medium {
    background: #f59e0b;
    color: white;
}

.badge-low {
    background: #3b82f6;
    color: white;
}

.cvss-score {
    background: #64748b;
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 4px;
    font-size: 0.875rem;
    font-weight: 600;
}

.code-block {
    background: #1e293b;
    color: #e2e8f0;
    padding: 1rem;
    border-radius: 6px;
    overflow-x: auto;
    margin: 1rem 0;
}

.code-block pre {
    margin: 0;
    font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
    font-size: 0.875rem;
    line-height: 1.5;
}

.recommendation {
    background: #f0fdf4;
    border: 1px solid #10b981;
    border-radius: 6px;
    padding: 1.5rem;
    margin-top: 1rem;
}

.recommendation h4 {
    margin-top: 0;
    color: #065f46;
}

.recommendation-priority {
    background: #f8fafc;
    border-left: 4px solid #3b82f6;
    padding: 1.5rem;
    margin: 1rem 0;
    border-radius: 4px;
}

.recommendation-priority h3 {
    margin-top: 0;
    color: #1e293b;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin: 1rem 0;
}

thead {
    background: #f8fafc;
}

th {
    padding: 0.75rem;
    text-align: left;
    font-weight: 600;
    color: #475569;
    border-bottom: 2px solid #e2e8f0;
}

td {
    padding: 0.75rem;
    border-bottom: 1px solid #e5e7eb;
}

tbody tr:hover {
    background: #f8fafc;
}

a {
    color: #3b82f6;
    text-decoration: none;
}

a:hover {
    text-decoration: underline;
}
</style>

    </div>
</body>
</html>